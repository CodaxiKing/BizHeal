
---

### Prompt Parte 2: Criando o "Scanner de Churn" (Primeira Lógica de Negócio)

**Objetivo:** Usar os dados importados para criar a primeira análise inteligente: identificar clientes com risco de churn.

```prompt
[INSTRUÇÃO GERAL]
Aja como um Desenvolvedor Full-Stack Sênior. Sua tarefa é criar a primeira funcionalidade de análise inteligente do BizHeal: um "Scanner de Risco de Churn". Você irá criar a lógica no backend e exibir os resultados no frontend.

[CONTEXTO]
Os dados de transações já estão sendo salvos no banco de dados (`Transaction`). Agora vamos analisá-los.

[REQUISITOS]

**1. Backend (API NestJS):**
- Crie um novo módulo (`AnalysisModule`) e um `AnalysisService`.
- No `AnalysisService`, crie um método chamado `calculateChurnRisk(businessId: string)`.
- A lógica de negócio será simples por enquanto:
    1. Busque todas as transações do `businessId`.
    2. Agrupe as transações por `customerId`.
    3. Para cada cliente, encontre a data da última transação.
    4. Se a última transação foi há mais de 90 dias (a partir da data atual), o cliente é considerado "em risco".
- Crie um `AnalysisController` com um endpoint `GET /analysis/churn-risk`.
- Este endpoint deve chamar o serviço e retornar um JSON com:
    - `totalCustomers`: número total de clientes.
    - `atRiskCustomersCount`: número de clientes em risco.
    - `atRiskCustomersList`: um array com os IDs dos clientes em risco e a data da última compra.

**2. Frontend (`apps/app`):**
- Na página principal do Dashboard (`/dashboard`), crie uma nova seção chamada "Saúde dos Clientes".
- Crie um novo componente React que faz uma chamada (fetch) para o endpoint `/analysis/churn-risk`.
- Use os componentes `Card` do Shadcn/UI para exibir os números principais (`totalCustomers` e `atRiskCustomersCount`).
- Use um componente `Table` do Shadcn/UI para listar os clientes em risco (`atRiskCustomersList`), mostrando o ID do cliente e há quantos dias foi a última compra.
- Adicione um indicador visual de alerta (um ícone de "⚠️") se o número de clientes em risco for maior que 0.
